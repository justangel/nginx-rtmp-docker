user nobody;
worker_processes 1;
load_module /usr/lib/nginx/modules/ngx_rtmp_module.so;
rtmp_auto_push on;
events {}
pcre_jit on;


http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;


        location / {
            root   /etc/nginx/www;
            index  index.html index.htm;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /etc/nginx/www/50x.html {
            root   /etc/nginx/www;
        }

        location /stat {
            rtmp_stat all;

            # Use this stylesheet to view XML as web page
            # in browser
            rtmp_stat_stylesheet stat.xsl;
        }

        location /stat.xsl {
            # XML stylesheet to view RTMP stats.
            # Copy stat.xsl wherever you want
            # and put the full directory path here
            root /etc/nginx/www/;
        }
}

    }

rtmp {

     server {
        listen 1935;
            chunk_size 4000;

        application transcode {
            live on;
            record off;
            exec_push ffmpeg -re -i "rtmp://localhost:1935/transcode/$name live=1"
            -vcodec libx264 
            -preset medium 
            -x264opts nal-hrd=cbr:force-cfr=1:keyint=120 
            -r 60 
            -b:v 5500k 
            -maxrate 5500k 
            -bufsize 5500k 
            -threads 8 
            -s hd720 
            -pix_fmt yuv420p 
            -sws_flags lanczos 
            -acodec copy 
            -f flv "rtmp://localhost:1935/live/$name" 
            2>>/etc/nginx/ffmpeg-$name.log;
        }
        application live {
             live on;
             record off;
             push rtmp://live-arn.twitch.tv/app/$name;
        }
         application test {
             live on;
             record off;
          }
            }      
}

